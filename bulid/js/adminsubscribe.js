$(function(){function e(){$.ajax({url:"src/sever/getsubscribelist.php",type:"GET",dataTypes:"json",success:function(e){var t=$("#subscribetable tbody");$.each(e,function(s,i){var l=$("<tr></tr>"),a=$("<td></td>").html(e[s].listvalue),r=$("<td></td>").html(e[s].listindex),n=$("<td></td>").html(e[s].listtime),u=$("<td></td>").html(e[s].listsrc);editwrap=$("<td></td>"),listupdate=$('<button type="button" class="btn btn-primary btn-xs">编辑</button>'),listdelete=$('<button type="button" class="btn btn-danger btn-xs">删除</button>'),editwrap.append(listupdate).append(listdelete),l.append(a).append(r).append(n).append(u).append(editwrap),t.prepend(l)})},error:function(e){console.log(e)}})}e(),$("#submitsubscribe").on("click",function(t){t.preventDefault();if(function(){for(var e=0,t=$("#add_subscribe input"),s=t.size(),i=0;i<s;i++)t.eq(i).val()?t.eq(i).parent().removeClass("has-error"):(e+=1,t.eq(i).parent().addClass("has-error"));return 0==e}()){var s={listvalue:$("#subscribetitle").val(),listsrc:$("#subscribesrc").val(),listtime:$("#subscribetime").val(),listindex:$("#subscribeindex").val()};$.ajax({url:"src/sever/addsubscribe.php",type:"POST",dataTypes:"json",data:{newNews:JSON.stringify(s)},success:function(t){$("#subscribetable tbody").empty(),$("#add_subscribe input").val(""),e()}})}}),$("#subscribetable tbody").on("click",".btn-danger",function(){$("#del_listvalue").remove();var e=$(this).parent().prevAll().eq(3).html(),t=$('<p id="del_listvalue"></p>');t.html(e),$("#deleteModal .modal-body").append(t),$("#deleteModal").modal("show")}),$("#confirmDelete").on("click",function(){$.ajax({url:"src/sever/deletesubscribe.php",type:"POST",data:{del_listvalue:$("#del_listvalue").html()},success:function(t){$("#deleteModal").modal("hide"),$("#subscribetable tbody").empty(),e()},error:function(e){console.log(e)}})});var t=null;$("#subscribetable tbody").on("click",".btn-primary",function(){var e=$(this);$.ajax({url:"src/sever/getsubscribelist.php",type:"GET",dataTypes:"json",success:function(s){var i=null,l=e.parent().prevAll().eq(3).html();$.each(s,function(e,t){if(s[e].listvalue==l)return i=s[e],!1}),$("#usubscribetitle").val(i.listvalue),$("#usubscribeindex").val(i.listindex),$("#usubscribetime").val(i.listtime),$("#usubscribesrc").val(i.listsrc),t=i.id},error:function(e){console.log(e)}}),$("#updateModal").modal("show")}),$("#updatesubscribe").on("click",function(){var s={listvalue:$("#usubscribetitle").val(),listsrc:$("#usubscribesrc").val(),listtime:$("#usubscribetime").val(),listindex:$("#usubscribeindex").val(),listid:t};$.ajax({url:"src/sever/updatesubscribe.php",type:"POST",data:{update:JSON.stringify(s)},success:function(t){$("#updateModal").modal("hide"),$("#subscribetable tbody").empty(),e()},error:function(e){console.log(e)}})}),$(".datetimepicker").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd",autoclose:!0,minView:2,weekStart:0})});