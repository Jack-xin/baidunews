$(function(){function refreshTable(){$.ajax({url:"src/sever/getcarousel.php",type:"GET",dataTypes:"json",data:{carouseltype:""},success:function(response){var tbody=$("#newstable tbody"),data=eval("("+response+")");data.forEach(function(e,t){var a=$("<tr></tr>"),l=$("<td></td>").html(data[t].carouseltype),s=$("<td></td>").html(data[t].carouseltitle),r=$("<td></td>").html(data[t].carouseltime),o=$("<td></td>"),u=$('<button type="button" class="btn btn-primary btn-xs">编辑</button>'),n=$('<button type="button" class="btn btn-danger btn-xs">删除</button>');o.append(u).append(n),a.append(l).append(s).append(r).append(o),tbody.prepend(a)})},error:function(e){console.log(e)}})}refreshTable(),$.ajax({url:"src/sever/getsubscribelist.php",type:"GET",dataTypes:"json",success:function(e){var t=$("#carouseltype");$.each(e,function(a,l){var s=$("<option></option>");s.html(e[a].listvalue),t.append(s)})},error:function(e){console.log(e)}}),$("#submitnews").on("click",function(e){e.preventDefault();if(function(){for(var e=0,t=$("#add_carousel input"),a=t.size(),l=0;l<a;l++)t.eq(l).val()?t.eq(l).parent().removeClass("has-error"):(e+=1,t.eq(l).parent().addClass("has-error"));return 0==e}()){var t={carouseltype:$("#carouseltype").val(),carouseltitle:$("#carouseltitle").val(),carouselsrc:$("#carouselsrc").val(),carouseltime:$("#carouseltime").val(),carouselimg:$("#carouselimg").val()};$.ajax({url:"src/sever/addcarousel.php",type:"POST",dataTypes:"json",data:{newCarousel:JSON.stringify(t)},success:function(e){$("#newstable tbody").empty(),$("#add_carousel input").val(""),$("#carouseltype").val("推荐"),refreshTable()}})}}),$("#newstable tbody").on("click",".btn-danger",function(){$("#del_news_title").remove();var e=$(this).parent().prevAll().eq(1).html(),t=$('<p id="del_news_title"></p>');t.html(e),$("#deleteModal .modal-body").append(t),$("#deleteModal").modal("show")}),$("#confirmDelete").on("click",function(){$.ajax({url:"src/sever/deletecarousel.php",type:"POST",data:{del_news_title:$("#del_news_title").html()},success:function(e){$("#deleteModal").modal("hide"),$("#newstable tbody").empty(),refreshTable()},error:function(e){console.log(e)}})});var carouselid=null;$("#newstable tbody").on("click",".btn-primary",function(){var _this=$(this);$.ajax({url:"src/sever/getsubscribelist.php",type:"GET",dataTypes:"json",success:function(e){var t=$("#ucarouseltype");$.each(e,function(a,l){var s=$("<option></option>");s.html(e[a].listvalue),t.append(s)})},error:function(e){console.log(e)}}),$.ajax({url:"src/sever/getcarousel.php",type:"GET",dataTypes:"json",data:{carouseltype:""},success:function(response){var updatelist=null,originaltitle=_this.parent().prevAll().eq(1).html(),optionValue=null,data=eval("("+response+")");$.each(data,function(e,t){if(data[e].carouseltitle==originaltitle)return updatelist=data[e],!1}),$("#ucarouseltype").val(updatelist.carouseltype),$("#ucarouseltitle").val(updatelist.carouseltitle),$("#ucarouselsrc").val(updatelist.carouselsrc),$("#ucarouseltime").val(updatelist.carouseltime),$("#ucarouselimg").val(updatelist.carouselimg),carouselid=updatelist.id},error:function(e){console.log(e)}}),$("#updateModal").modal("show")}),$("#updatenews").on("click",function(){var e={carouseltype:$("#ucarouseltype").val(),carouseltitle:$("#ucarouseltitle").val(),carouselsrc:$("#ucarouselsrc").val(),carouseltime:$("#ucarouseltime").val(),carouselimg:$("#ucarouselimg").val(),carouselid:carouselid};$.ajax({url:"src/sever/updatecarousel.php",type:"POST",data:{update:JSON.stringify(e)},success:function(e){$("#updateModal").modal("hide"),$("#newstable tbody").empty(),refreshTable()},error:function(e){console.log(e)}})}),$(".datetimepicker").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd",autoclose:!0,minView:2,weekStart:0})});