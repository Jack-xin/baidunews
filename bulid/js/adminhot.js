$(function(){function refreshTable(){$.ajax({url:"src/sever/gethot.php",type:"GET",dataTypes:"json",data:{hottype:""},success:function(response){var tbody=$("#newstable tbody"),data=eval("("+response+")");data.forEach(function(t,e){var a=$("<tr></tr>"),o=$("<td></td>").html(data[e].hottype),n=$("<td></td>").html(data[e].hottitle),l=$("<td></td>").html(data[e].hottime),s=$("<td></td>"),r=$('<button type="button" class="btn btn-primary btn-xs">编辑</button>'),i=$('<button type="button" class="btn btn-danger btn-xs">删除</button>');s.append(r).append(i),a.append(o).append(n).append(l).append(s),tbody.prepend(a)})},error:function(t){console.log(t)}})}refreshTable(),$.ajax({url:"src/sever/getsubscribelist.php",type:"GET",dataTypes:"json",success:function(t){var e=$("#hottype");$.each(t,function(a,o){var n=$("<option></option>");n.html(t[a].listvalue),e.append(n)})},error:function(t){console.log(t)}}),$("#submitnews").on("click",function(t){t.preventDefault();if(function(){for(var t=0,e=$("#add_hot input"),a=e.size(),o=0;o<a;o++)e.eq(o).val()?e.eq(o).parent().removeClass("has-error"):(t+=1,e.eq(o).parent().addClass("has-error"));return 0==t}()){var e={hottype:$("#hottype").val(),hottitle:$("#hottitle").val(),hotsrc:$("#hotsrc").val(),hottime:$("#hottime").val()};$.ajax({url:"src/sever/addhot.php",type:"POST",dataTypes:"json",data:{hotnews:JSON.stringify(e)},success:function(t){$("#newstable tbody").empty(),$("#add_hot input").val(""),$("#hottype").val("推荐"),refreshTable()}})}}),$("#newstable tbody").on("click",".btn-danger",function(){$("#del_news_title").remove();var t=$(this).parent().prevAll().eq(1).html(),e=$('<p id="del_news_title"></p>');e.html(t),$("#deleteModal .modal-body").append(e),$("#deleteModal").modal("show")}),$("#confirmDelete").on("click",function(){$.ajax({url:"src/sever/deletehot.php",type:"POST",data:{del_news_title:$("#del_news_title").html()},success:function(t){$("#deleteModal").modal("hide"),$("#newstable tbody").empty(),refreshTable()},error:function(t){console.log(t)}})});var hotid=null;$("#newstable tbody").on("click",".btn-primary",function(){var _this=$(this);$.ajax({url:"src/sever/getsubscribelist.php",type:"GET",dataTypes:"json",success:function(t){var e=$("#uhottype");$.each(t,function(a,o){var n=$("<option></option>");n.html(t[a].listvalue),e.append(n)})},error:function(t){console.log(t)}}),$.ajax({url:"src/sever/gethot.php",type:"GET",dataTypes:"json",data:{hottype:""},success:function(response){var updatelist=null,originaltitle=_this.parent().prevAll().eq(1).html(),data=eval("("+response+")");$.each(data,function(t,e){if(data[t].hottitle==originaltitle)return updatelist=data[t],!1}),$("#uhottype").val(updatelist.hottype),$("#uhottitle").val(updatelist.hottitle),$("#uhotsrc").val(updatelist.hotsrc),$("#uhottime").val(updatelist.hottime),hotid=updatelist.id},error:function(t){console.log(t)}}),$("#updateModal").modal("show")}),$("#updatenews").on("click",function(){var t={hottype:$("#uhottype").val(),hottitle:$("#uhottitle").val(),hotsrc:$("#uhotsrc").val(),hottime:$("#uhottime").val(),hotid:hotid};$.ajax({url:"src/sever/updatehot.php",type:"POST",data:{update:JSON.stringify(t)},success:function(t){$("#updateModal").modal("hide"),$("#newstable tbody").empty(),refreshTable()},error:function(t){console.log(t)}})}),$(".datetimepicker").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd",autoclose:!0,minView:2,weekStart:0})});